name: DeLivva Authorization CI

on: [push]
jobs:
  run-test:
    services:
      postgres:
        image: postgres:latest
        env:
          POSTGRES_DB: ${{ secrets.POSTGRES_DB }}
          POSTGRES_USER: ${{ secrets.POSTGRES_USER }}
          POSTGRES_PASSWORD: ${{ secrets.POSTGRES_PASSWORD }}
        ports:
          - 5432:5432

    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Initialize Database
        run: |
          PGPASSWORD=${{ secrets.POSTGRES_PASSWORD }} psql -h localhost -U ${{ secrets.POSTGRES_USER }} -d postgres -c "SELECT 'CREATE DATABASE delivva_authorization' WHERE NOT EXISTS (SELECT FROM pg_database WHERE datname = 'delivva_authorization');"
      

      - name: Checkout 'develop' branch
        run: |
         git fetch origin develop
         git checkout develop

      - name: Debug Logging
        run: |
          echo "POSTGRES_DB: ${{ secrets.POSTGRES_DB }}"
          echo "POSTGRES_USER: ${{ secrets.POSTGRES_USER }}"
          echo "POSTGRES_PASSWORD: ${{ secrets.POSTGRES_PASSWORD }}"
      - uses: actions/setup-java@v3
        with:
          java-version: '17'
          distribution: 'temurin'
          cache: maven

      - name: Build with Maven
        run: mvn clean install

